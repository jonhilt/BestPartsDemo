@page "/"
@using BestPartsDemo.Models
@using BestPartsDemo.Services
@inject IContactService ContactService
@rendermode InteractiveServer

<PageTitle>Contacts</PageTitle>

<div class="container mx-auto px-4 py-8">
    <div class="mb-8">
        <h1 class="text-4xl font-bold text-gray-800 mb-2">Contacts</h1>
        <p class="text-gray-600">Everyone you've ever met, all on one handy card wall!</p>
    </div>

    @if (_isLoading)
    {
        <LoadingSpinner Message="Loading contacts..."/>
    }
    else
    {
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            @foreach (var contact in _contacts ?? Enumerable.Empty<Contact>())
            {
                <ContactCard Contact="@contact"/>
            }
        </div>
    }
</div>

@code {

    List<Contact>? _contacts;

    private bool _isLoading;

    protected override async Task OnInitializedAsync()
    {
        Console.WriteLine($"Contacts Length: {(RendererInfo.IsInteractive ? "interactive" : "prerender")}: {_contacts?.Count ?? 0}");

        if (_contacts == null)
        {
            Console.WriteLine("fetching contacts...");

            _isLoading = true;
            await Task.Delay(500); // Simulate loading delay for demo purposes
            _contacts = await ContactService.GetAllContactsAsync();
            _isLoading = false;
        }
    }

}